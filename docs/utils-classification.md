# 自动化测试工具类分类与说明

## 一、数据生成工具类 (Data Generation Utils)

### 1.1 `fakeDataUtil.ts` - 假数据生成工具
**功能：**
- 生成随机用户名、邮箱、手机号、身份证号
- 生成随机字符串、数字、日期
- 生成随机地址、公司名称、职位
- 生成符合特定格式的数据（如：UUID、订单号、流水号）

**使用场景：**
- 测试数据准备：快速生成大量测试数据
- 表单填写：自动填充表单字段
- 边界测试：生成超长字符串、特殊字符等
- 性能测试：批量生成测试数据

**为什么要封装：**
- 统一数据生成规则，确保测试数据的一致性
- 减少重复代码，提高测试编写效率
- 支持自定义规则，满足不同业务场景需求
- 使用 `@faker-js/faker` 库，提供丰富的数据类型

**示例：**
```typescript
// 生成用户数据
const user = fakeDataUtil.generateUser();
// { name: '张三', email: 'zhangsan@example.com', phone: '13800138000' }

// 生成订单号
const orderNo = fakeDataUtil.generateOrderNo('ORD');
// 'ORD20240101123456789'
```

---

### 1.2 `testDataUtil.ts` - 测试数据管理工具
**功能：**
- 从 JSON/CSV/YAML 文件加载测试数据
- 数据模板化：支持变量替换和参数化
- 数据验证：检查测试数据的完整性和有效性
- 数据缓存：避免重复读取文件

**使用场景：**
- 数据驱动测试：从外部文件读取测试用例数据
- 批量测试：使用同一套数据模板测试多个场景
- 环境隔离：不同环境使用不同的测试数据文件

**为什么要封装：**
- 测试数据与测试代码分离，便于维护
- 支持多种数据格式，灵活应对不同需求
- 提供数据验证机制，提前发现数据问题
- 统一数据访问接口，简化测试代码

---

## 二、等待与同步工具类 (Wait & Sync Utils)

### 2.1 `waitUtil.ts` - 智能等待工具
**功能：**
- 等待元素出现/消失/可点击/可见
- 等待网络请求完成（基于 Playwright 的 waitForResponse）
- 等待页面加载完成（包括动态内容）
- 等待特定条件满足（自定义等待函数）
- 等待文件下载完成

**使用场景：**
- 处理异步操作：等待 AJAX 请求完成后再断言
- 处理动态内容：等待 SPA 页面内容加载
- 处理文件操作：等待文件上传/下载完成
- 处理动画效果：等待动画结束后再操作

**为什么要封装：**
- Playwright 的等待机制需要手动处理，封装后更简洁
- 统一超时时间配置，避免硬编码
- 提供更语义化的等待方法，提高代码可读性
- 处理常见的等待场景，减少重复代码

**示例：**
```typescript
// 等待元素可点击
await waitUtil.waitForClickable(page, 'button#submit', 5000);

// 等待所有请求完成
await waitUtil.waitForAllRequests(page);

// 等待文件下载
const download = await waitUtil.waitForDownload(page, 'button#download');
```

---

### 2.2 `retryUtil.ts` - 重试工具
**功能：**
- 自动重试失败的操作（如：点击、输入、断言）
- 支持指数退避策略
- 支持条件重试（只在特定错误时重试）
- 记录重试日志

**使用场景：**
- 网络不稳定：重试网络请求
- 元素加载慢：重试元素操作
- 断言失败：重试断言（谨慎使用）
- 并发测试：处理竞态条件

**为什么要封装：**
- 提高测试稳定性，减少因环境问题导致的失败
- 统一重试策略，避免代码重复
- 提供详细的重试日志，便于问题排查
- 支持灵活的重试配置

---

## 三、断言增强工具类 (Assertion Utils)

### 3.1 `assertUtil.ts` - 增强断言工具
**功能：**
- 断言 HTTP 响应状态码和内容
- 断言 JSON 数据结构（深度比较、部分匹配）
- 断言数组/对象包含特定元素
- 断言文件内容
- 断言数据库记录（如果涉及数据库测试）

**使用场景：**
- API 测试：验证接口返回数据
- UI 测试：验证页面显示内容
- 数据验证：验证业务数据的正确性
- 文件验证：验证生成的文件内容

**为什么要封装：**
- 提供更丰富的断言方法，覆盖常见验证场景
- 提供更友好的错误信息，便于问题定位
- 统一断言风格，提高代码一致性
- 支持自定义断言逻辑

**示例：**
```typescript
// 断言响应数据
assertUtil.assertResponse(response, {
  status: 200,
  body: { success: true, data: { id: expect.any(Number) } }
});

// 断言数组包含元素
assertUtil.assertArrayContains(users, { name: '张三' });
```

---

## 四、文件操作工具类 (File Utils)

### 4.1 `fileUtil.ts` - 文件操作工具
**功能：**
- 读取/写入 JSON、CSV、YAML 文件
- 文件上传/下载处理
- 文件内容比较
- 临时文件管理（创建、清理）
- 文件路径处理

**使用场景：**
- 测试数据读取：从文件加载测试数据
- 文件上传测试：处理文件上传场景
- 文件下载验证：验证下载的文件内容
- 报告生成：保存测试结果到文件

**为什么要封装：**
- 统一文件操作接口，简化代码
- 处理不同操作系统的路径差异
- 提供文件验证功能，确保文件操作正确
- 自动管理临时文件，避免文件泄漏

---

### 4.2 `screenshotUtil.ts` - 截图工具
**功能：**
- 页面截图（全屏、元素、区域）
- 失败时自动截图
- 截图对比（视觉回归测试）
- 截图标注（添加文字、箭头等）

**使用场景：**
- 失败调试：测试失败时自动截图
- 视觉回归：对比页面变化
- 文档生成：生成测试报告截图
- Bug 记录：保存问题截图

**为什么要封装：**
- 统一截图命名和存储规则
- 自动处理截图路径和文件管理
- 提供截图对比功能，支持视觉回归测试
- 集成到测试流程中，无需手动处理

---

## 五、日期时间工具类 (Date & Time Utils)

### 5.1 `dateUtil.ts` - 日期时间工具
**功能：**
- 日期格式化（多种格式）
- 日期计算（加减天数、月份、年份）
- 日期比较和验证
- 时区转换
- 生成时间戳

**使用场景：**
- 测试数据生成：生成特定日期的测试数据
- 日期选择器测试：选择特定日期
- 时间相关断言：验证时间字段
- 日志记录：格式化日志时间

**为什么要封装：**
- 统一日期格式，避免格式不一致问题
- 简化日期计算，提高代码可读性
- 处理时区问题，确保测试准确性
- 提供常用日期操作，减少重复代码

**示例：**
```typescript
// 获取明天的日期
const tomorrow = dateUtil.addDays(new Date(), 1);

// 格式化日期
const formatted = dateUtil.format(new Date(), 'YYYY-MM-DD HH:mm:ss');

// 生成时间范围
const dateRange = dateUtil.getDateRange('2024-01-01', '2024-01-31');
```

---

## 六、字符串处理工具类 (String Utils)

### 6.1 `stringUtil.ts` - 字符串工具
**功能：**
- 字符串模板替换（支持变量）
- 字符串截取、填充、格式化
- 特殊字符处理（转义、编码）
- 字符串验证（邮箱、手机号、URL 等）
- 随机字符串生成

**使用场景：**
- 动态内容生成：根据模板生成文本
- 数据清理：处理特殊字符和格式
- 验证测试：测试输入验证逻辑
- URL 构建：动态构建请求 URL

**为什么要封装：**
- 提供常用字符串操作方法
- 统一字符串处理逻辑
- 支持模板化，提高灵活性
- 处理编码问题，避免乱码

---

## 七、页面操作增强工具类 (Page Action Utils)

### 7.1 `pageActionUtil.ts` - 页面操作增强工具
**功能：**
- 滚动到元素（支持多种滚动方式）
- 拖拽操作（元素拖拽、文件拖拽）
- 键盘快捷键模拟
- 鼠标操作（悬停、右键、双击）
- 表单自动填充（智能识别表单字段）

**使用场景：**
- 复杂交互测试：测试拖拽、滚动等操作
- 表单测试：快速填充表单
- 快捷键测试：测试键盘操作
- 移动端测试：模拟触摸操作

**为什么要封装：**
- 简化复杂操作，提供更高级的 API
- 处理浏览器兼容性问题
- 提供更语义化的方法名
- 统一操作风格，提高代码可维护性

**示例：**
```typescript
// 滚动到元素并等待可见
await pageActionUtil.scrollToElement(page, 'button#submit');

// 智能填充表单
await pageActionUtil.fillForm(page, {
  name: '张三',
  email: 'zhangsan@example.com'
});

// 拖拽元素
await pageActionUtil.dragAndDrop(page, '#source', '#target');
```

---

### 7.2 `elementUtil.ts` - 元素定位增强工具
**功能：**
- 智能元素定位（多种定位策略组合）
- 元素存在性检查（不抛异常）
- 元素列表操作（批量操作）
- 元素属性/文本提取
- 元素截图

**使用场景：**
- 元素定位：处理动态元素、iframe 元素
- 元素验证：检查元素是否存在、可见
- 批量操作：操作列表中的多个元素
- 数据提取：从页面提取数据用于验证

**为什么要封装：**
- 提供更灵活的元素定位策略
- 统一元素操作接口
- 处理常见的元素定位问题（如：等待、重试）
- 提供元素信息提取功能

---

## 八、网络请求工具类 (Network Utils)

### 8.1 `httpCaptureUtil.ts` ✅ (已实现)
**功能：**
- 捕获 HTTP 请求和响应
- 支持 URL 模式匹配
- 等待特定请求完成

**使用场景：**
- API 测试：验证接口调用
- 性能测试：监控网络请求
- 调试：查看实际发送的请求

---

### 8.2 `mockUtil.ts` - Mock 工具
**功能：**
- Mock HTTP 请求响应
- Mock API 接口（支持动态响应）
- Mock 文件下载
- Mock WebSocket/SSE 连接

**使用场景：**
- 接口测试：Mock 后端接口
- 前端测试：Mock 第三方服务
- 离线测试：在没有后端的情况下测试前端
- 异常测试：模拟错误响应

**为什么要封装：**
- 统一 Mock 配置和管理
- 提供更灵活的 Mock 策略
- 简化 Mock 设置，提高测试效率
- 支持动态 Mock，适应复杂场景

---

### 8.3 `sseUtil.ts` ✅ (已实现)
**功能：**
- 监听 SSE 事件流
- 捕获 SSE 事件数据
- 等待 SSE 完成

**使用场景：**
- 实时数据测试：测试 SSE 推送
- 长连接测试：验证 SSE 连接稳定性

---

## 九、Cookie 和 Session 管理工具类

### 9.1 `cookieUtil.ts` - Cookie 管理工具
**功能：**
- 设置/获取 Cookie
- Cookie 导入/导出（用于登录状态复用）
- Cookie 验证（检查 Cookie 是否存在、有效）
- 清除 Cookie

**使用场景：**
- 登录状态复用：保存登录 Cookie，避免重复登录
- 权限测试：测试不同权限下的功能
- 会话测试：测试会话超时、失效等场景

**为什么要封装：**
- 简化 Cookie 操作，提供统一接口
- 支持 Cookie 持久化，提高测试效率
- 处理 Cookie 格式转换
- 提供 Cookie 验证功能

**示例：**
```typescript
// 保存登录 Cookie
await cookieUtil.saveCookies(page, 'login-cookies.json');

// 加载 Cookie（复用登录状态）
await cookieUtil.loadCookies(page, 'login-cookies.json');

// 验证 Cookie
const isValid = await cookieUtil.verifyCookie(page, 'sessionId');
```

---

## 十、环境配置工具类 (Environment Utils)

### 10.1 `envUtil.ts` - 环境配置工具
**功能：**
- 读取环境变量
- 环境切换（dev/test/prod）
- 配置验证（检查必需配置是否存在）
- 配置合并（多环境配置合并）

**使用场景：**
- 多环境测试：在不同环境运行测试
- 配置管理：统一管理测试配置
- 环境隔离：不同环境使用不同配置

**为什么要封装：**
- 统一配置访问接口
- 提供配置验证，避免配置错误
- 支持环境切换，提高灵活性
- 处理配置优先级和合并

---

## 十一、日志和报告工具类 (Logging & Reporting Utils)

### 11.1 `loggerUtil.ts` - 日志工具 ✅ (已有基础实现)
**功能增强：**
- 日志级别控制（DEBUG/INFO/WARN/ERROR）
- 日志格式化（时间戳、调用栈）
- 日志文件输出
- 日志过滤和搜索

**使用场景：**
- 测试调试：记录测试执行过程
- 问题排查：通过日志定位问题
- 测试报告：生成详细的测试日志

---

### 11.2 `reportUtil.ts` - 报告工具
**功能：**
- 生成测试报告（HTML、JSON、XML）
- 测试结果统计（通过率、失败率）
- 失败用例分析
- 测试趋势分析

**使用场景：**
- 测试结果展示：生成可视化报告
- 测试分析：分析测试覆盖率和趋势
- CI/CD 集成：在 CI 中展示测试结果

**为什么要封装：**
- 统一报告格式，便于查看和分析
- 提供丰富的报告内容（截图、日志、视频）
- 支持多种报告格式，适应不同需求
- 自动化报告生成，无需手动处理

---

## 十二、数据库操作工具类 (Database Utils) - 可选

### 12.1 `dbUtil.ts` - 数据库工具
**功能：**
- 数据库连接管理
- SQL 查询执行
- 数据清理和准备
- 事务管理

**使用场景：**
- 数据准备：测试前准备测试数据
- 数据验证：验证数据库中的数据
- 数据清理：测试后清理数据
- 数据迁移测试：测试数据库迁移脚本

**为什么要封装：**
- 统一数据库操作接口
- 处理数据库连接和事务
- 提供数据清理功能，确保测试隔离
- 支持多种数据库类型

**注意：** 只有在需要直接操作数据库时才需要此工具类。

---

## 十三、性能监控工具类 (Performance Utils)

### 13.1 `performanceUtil.ts` - 性能监控工具
**功能：**
- 页面加载时间监控
- 网络请求性能分析
- 内存使用监控
- 性能指标收集和报告

**使用场景：**
- 性能测试：监控页面性能
- 性能回归：检测性能退化
- 性能优化：分析性能瓶颈

**为什么要封装：**
- 统一性能监控接口
- 提供性能指标收集和分析
- 生成性能报告
- 支持性能基准对比

---

## 十四、验证码和图片处理工具类

### 14.1 `captchaUtil.ts` - 验证码处理工具
**功能：**
- OCR 识别验证码（简单验证码）
- 验证码图片预处理
- 验证码服务集成（第三方验证码识别服务）

**使用场景：**
- 登录测试：自动识别验证码
- 注册测试：处理注册验证码

**为什么要封装：**
- 统一验证码处理逻辑
- 支持多种验证码类型
- 提供验证码识别接口
- 处理验证码识别失败的情况

**注意：** 此工具类主要用于测试环境，生产环境应使用其他验证方式。

---

## 工具类封装的最佳实践

### 1. 单一职责原则
每个工具类只负责一个明确的功能领域，避免功能混杂。

### 2. 易于使用
提供简洁的 API，方法名语义化，参数清晰。

### 3. 错误处理
提供完善的错误处理和错误信息，便于问题排查。

### 4. 文档完善
每个工具类和方法都有清晰的注释和使用示例。

### 5. 可测试性
工具类本身应该是可测试的，便于验证其正确性。

### 6. 可扩展性
设计时考虑未来扩展，支持自定义配置和扩展点。

### 7. 性能考虑
避免不必要的操作，优化常用操作的性能。

---

## 工具类优先级建议

### 高优先级（立即实现）
1. ✅ `httpCaptureUtil.ts` - HTTP 请求捕获（已实现）
2. ✅ `sseUtil.ts` - SSE 事件监听（已实现）
3. `fakeDataUtil.ts` - 假数据生成
4. `waitUtil.ts` - 智能等待
5. `fileUtil.ts` - 文件操作
6. `cookieUtil.ts` - Cookie 管理

### 中优先级（后续实现）
7. `assertUtil.ts` - 增强断言
8. `pageActionUtil.ts` - 页面操作增强
9. `elementUtil.ts` - 元素定位增强
10. `dateUtil.ts` - 日期时间工具
11. `stringUtil.ts` - 字符串工具
12. `mockUtil.ts` - Mock 工具

### 低优先级（按需实现）
13. `retryUtil.ts` - 重试工具
14. `screenshotUtil.ts` - 截图工具
15. `testDataUtil.ts` - 测试数据管理
16. `reportUtil.ts` - 报告工具
17. `performanceUtil.ts` - 性能监控
18. `dbUtil.ts` - 数据库工具（如果需要）
19. `captchaUtil.ts` - 验证码处理（如果需要）

---

## 总结

工具类的封装应该遵循"按需实现"的原则，根据实际测试需求逐步完善。优先实现使用频率高、影响范围大的工具类，避免过度设计。

每个工具类都应该：
- **解决实际问题**：针对测试中的痛点
- **提高效率**：减少重复代码，提高编写速度
- **易于维护**：代码清晰，文档完善
- **可扩展**：支持未来需求变化

